___INFO___

{
  "displayName": "Pinterest Tag",
  "description": "Tag to fire Pinterest events.",
  "securityGroups": [
    "NON_GOOGLE_SCRIPTS"
  ],
  "id": "pntr",
  "type": "TAG",
  "version": 1.4,
  "brand": {
    "thumbnail": "data:image/png;base64,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\u003d",
    "displayName": "Pinterest",
    "id": "brand_pinterest"
  },
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "notSetText": "Not set (Required)",
    "help": "Enter your tag ID. You can find your tags at https://ads.pinterest.com/conversion_tags/",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "args": [
          "26\\d{11}"
        ],
        "type": "REGEX"
      }
    ],
    "displayName": "Tag ID",
    "name": "tagId",
    "type": "TEXT",
    "valueHint": "Pinterest Tag ID"
  },
  {
    "notSetText": "Not set (required for Enhanced Match)",
    "help": "Optional, but required for Enhanced Match. This is the user\u0027s email address, stripped of whitespace, lower-cased, then hashed with MD5, SHA1, or SHA-256. As a fallback, a raw email address can also be used. In this case, we will hash the email address for you, in the browser. (The email address *never* leaves the browser, and Pinterest never sees it.) See https://help.pinterest.com/en/business/article/enhanced-match for more information.",
    "displayName": "Hashed Email",
    "name": "em",
    "type": "TEXT",
    "valueHint": "{{email}}"
  },
  {
    "macrosInSelect": false,
    "selectItems": [
      {
        "displayValue": "Base Code Only (no event)",
        "value": ""
      },
      {
        "displayValue": "Page Visit",
        "help": "Track visits to specific pages on your website.",
        "value": "pagevisit"
      },
      {
        "displayValue": "Add to Cart",
        "value": "addtocart"
      },
      {
        "displayValue": "Checkout",
        "value": "checkout"
      },
      {
        "displayValue": "Signup",
        "value": "signup"
      },
      {
        "displayValue": "Watch Video",
        "value": "watchvideo"
      },
      {
        "displayValue": "Lead",
        "value": "lead"
      },
      {
        "displayValue": "Search",
        "value": "search"
      },
      {
        "displayValue": "View Category",
        "value": "viewcategory"
      },
      {
        "displayValue": "Custom",
        "value": "custom"
      }
    ],
    "displayName": "Event to Fire",
    "name": "eventName",
    "type": "SELECT"
  },
  {
    "help": "Enter optional order information here. Setting these values is highly recommended to improve conversions and reporting.",
    "enablingConditions": [
      {
        "paramName": "eventName",
        "type": "EQUALS",
        "paramValue": "checkout"
      },
      {
        "paramName": "eventName",
        "type": "EQUALS",
        "paramValue": "addtocart"
      }
    ],
    "displayName": "Cart Parameters",
    "name": "checkout",
    "groupStyle": "NO_ZIPPY",
    "type": "GROUP",
    "subParams": [
      {
        "help": "Make sure to set a currency code to ensure proper currency conversion; otherwise, we\u0027ll default to USD.",
        "displayName": "Order Value",
        "name": "value",
        "type": "TEXT"
      },
      {
        "help": "Must be one of USD, GBP, CAD, EUR, AUD or NZD. If you don\u0027t set a currency code, we\u0027ll default to USD.",
        "valueValidators": [
          {
            "args": [
              3,
              3
            ],
            "errorMessage": "Please enter a valid currency.",
            "type": "STRING_LENGTH"
          }
        ],
        "displayName": "Currency",
        "name": "currency",
        "type": "TEXT"
      },
      {
        "valueValidators": [
          {
            "type": "NUMBER"
          }
        ],
        "displayName": "Order Quantity",
        "name": "order_quantity",
        "type": "TEXT"
      },
      {
        "displayName": "Order ID",
        "simpleValueType": true,
        "name": "order_id",
        "type": "TEXT"
      }
    ]
  },
  {
    "help": "These fields are required for dynamic retargeting on Pinterest. Optional otherwise.",
    "enablingConditions": [
      {
        "paramName": "eventName",
        "type": "EQUALS",
        "paramValue": "pagevisit"
      },
      {
        "paramName": "eventName",
        "type": "EQUALS",
        "paramValue": "addtocart"
      },
      {
        "paramName": "eventName",
        "type": "EQUALS",
        "paramValue": "checkout"
      }
    ],
    "displayName": "Line Items",
    "name": "line_items",
    "groupStyle": "NO_ZIPPY",
    "type": "GROUP",
    "subParams": [
      {
        "displayName": "Product ID",
        "simpleValueType": true,
        "name": "product_id",
        "type": "TEXT"
      },
      {
        "displayName": "Product Category",
        "simpleValueType": true,
        "name": "product_category",
        "type": "TEXT"
      }
    ]
  },
  {
    "help": "Optional field to set the lead type.",
    "enablingConditions": [
      {
        "paramName": "eventName",
        "type": "EQUALS",
        "paramValue": "lead"
      },
      {
        "paramName": "eventName",
        "type": "EQUALS",
        "paramValue": "signup"
      }
    ],
    "displayName": "Lead Type",
    "name": "lead_type",
    "type": "TEXT"
  },
  {
    "help": "Search Keywords",
    "enablingConditions": [
      {
        "paramName": "eventName",
        "type": "EQUALS",
        "paramValue": "search"
      }
    ],
    "displayName": "Search Query",
    "name": "search_query",
    "type": "TEXT"
  },
  {
    "enablingConditions": [
      {
        "paramName": "eventName",
        "type": "NOT_EQUALS",
        "paramValue": ""
      }
    ],
    "name": "setCustomParams",
    "checkboxText": "Custom Parameters",
    "type": "CHECKBOX",
    "subParams": [
      {
        "enablingConditions": [
          {
            "paramName": "setCustomParams",
            "type": "EQUALS",
            "paramValue": true
          }
        ],
        "displayName": "",
        "name": "customParameters",
        "groupStyle": "NO_ZIPPY",
        "type": "GROUP",
        "subParams": [
          {
            "name": "values",
            "simpleTableColumns": [
              {
                "selectItems": [],
                "defaultValue": "",
                "displayName": "Name",
                "name": "name",
                "type": "TEXT"
              },
              {
                "defaultValue": "",
                "displayName": "Value",
                "name": "value",
                "type": "TEXT"
              }
            ],
            "type": "SIMPLE_TABLE"
          }
        ]
      }
    ]
  },
  {
    "type": "LABEL",
    "name": "aem_upsell",
    "displayName": "\u003cb\u003eEnable automatic enhanced match? \u003c/b\u003eAutomatic enhanced match can help attribute more conversions to your Pinterest ads and increase audience sizes. Navigate to \u003ca href\u003d\"https://ads.pinterest.com/conversions/tag\"\u003ePinterest Ads Manager\u003c/a\u003e to enable. \u003ca href\u003d\"https://help.pinterest.com/business/article/automatic-enhanced-match\"\u003eLearn more\u003c/a\u003e\u003c/br\u003e"
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const copyFromWindow = require('copyFromWindow');
const createArgumentsQueue = require('createArgumentsQueue');
const injectScript = require('injectScript');
const log = require('logToConsole');
const makeTableMap = require('makeTableMap');

/**
 * This GTM snippet takes care of loading the Pinterest tag and firing events.
 * It is roughly equivalent to installing the Pinterest Tag base code and then
 * using pintrk() to fire events. It will do the base tag functionality only
 * once so you can load and call this multiple times without worrying multiple
 * loads, etc.
 */
log('GTM PTag v1.4; tagId: ' + data.tagId);

// Check to see if we've already created the queue.
const isFirstLoad = !copyFromWindow('pintrk');

// Set up window.pintrk. Won't re-create if it already exists.
const pintrk = createArgumentsQueue('pintrk', 'pintrk.queue');

/**
 * First-time Load/Initialization.
 */
if (isFirstLoad) {
  // OK to call 'load' and 'page' events before injecting script,
  // it will process existing items in the queue on load.
  const initializationData = {
    'np': 'gtm',
  };
  if (data.em) {
    initializationData.em = data.em;
  }
  pintrk('load', data.tagId.toString(), initializationData);
  pintrk('page');
} else if (data.em) {
  const partnerDataUpdate = {
    'em': data.em,
  };
  pintrk('set', partnerDataUpdate);
}

// Special case: this if block is written to handle the case where the base
// code is fired after another event, which would cause isFirstLoad to run
// but not include config values
if (data.eventName === "") {
  const partnerDataUpdate = {};
  pintrk('set', partnerDataUpdate);
}

/**
 * Define function to setup event data and call pintrk() as needed.
 * Intentionally verbose for completeness.
 */
const onSuccess = function() {

  let eventData = {};

  // Copy custom parameters, if any, into eventData.
  // We do this first so that in case someone has defined
  // a custom parameter with the same name as a top-level
  // field, then the top-level field will take precedence.
  if (data.setCustomParams) {
    eventData = makeTableMap(data.values, 'name', 'value');
  }

  // In the extremely unlikely event that someone has created a 'np'
  // custom field, we make sure to override that.
  eventData.np = 'gtm';

  const safeCopyField = (fieldName) => {
    if (data[fieldName] !== undefined) {
      eventData[fieldName] = data[fieldName];
    }
  };

  const safeCopyLineItem = (fieldName) => {
    if (data[fieldName] !== undefined) {
      if (eventData.line_items === undefined) {
        eventData.line_items = [{}];
      }
      eventData.line_items[0][fieldName] = data[fieldName];
    }
  };

  switch (data.eventName) {
    case 'watchvideo':   // No fields defined.
    case 'viewcategory': // No fields defined.
    case 'custom':       // Only custom fields, none preconfigured.
      break;
    case 'signup':       // Signup and Lead share the same single field.
    case 'lead':
      safeCopyField('lead_type');
      break;
    case 'search':
      safeCopyField('search_query');
      break;
    case 'addtocart':    // AddToCart and Checkout share the same fields.
    case 'checkout':
      safeCopyField('order_id');
      safeCopyField('order_quantity');
      safeCopyField('value');
      safeCopyField('currency');
      // Intentional fall-through, page vist has only ID and category.
    case 'pagevisit':
      safeCopyLineItem('product_id');
      safeCopyLineItem('product_category');
      break;
    default:
      // Just fallthrough as server-side code will take care of
      // emitting an error message to the console.
      break;
  }

  if (data.eventName !== '') {
    log('Firing Pinterest event: ' + data.eventName);
    log('Event Data:');
    log(eventData);
    pintrk('track', data.eventName, eventData);
  }
  data.gtmOnSuccess();
};

/**
 * Failure callback; server-size JS didn't load, log error and exit.
 */
const onFailure = function() {
  log('Pinterest Error: Loading JS failed!');
  data.gtmOnFailure();
};

// Async load
injectScript("https://s.pinimg.com/ct/core.js", onSuccess, onFailure, 'PinterestJS');


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "pintrk"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "pintrk.queue"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://s.pinimg.com/ct/core.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Points of Contact:

Yuchen Mou <ymou@pinterest.com>
Jian Li <jianli@pinterest.com>
Mirko Rodriguez Mallma <mrodriguezmallma@pinterest.com>

Created on 2/19/2019, 9:22:34 PM
Updated on 11/14/2022, 3:44:00 PM
